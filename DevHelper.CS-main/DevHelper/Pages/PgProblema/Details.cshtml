@page
@model DevHelper.Razor.Pages.PgProblema.DetailsModel
@using System.Security.Claims
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
    var userId = HttpContextAccessor.HttpContext.User?.FindFirstValue(ClaimTypes.NameIdentifier);
    var isOwner = userId != null && Model.Problema != null && userId == Model.Problema.UsuarioId.ToString();
}

<h1>@Html.DisplayFor(model => model.Problema.Nome)</h1>

<div>
    <h4>@Html.DisplayFor(model => model.Usuario.Nome)</h4>
    <hr />

    <h5 class="col-sm-2">
        @Html.DisplayNameFor(model => model.Problema.Descricao)
    </h5>
    <form method="post">
    <dd class="col-sm-10">
            @if (isOwner)
            {
            <textarea class="form-control" asp-for="Problema.Descricao" rows="10">@Model.Problema.Descricao</textarea>
            }
            else
            {
            <textarea class="form-control" asp-for="Problema.Descricao" rows="10" readonly>@Model.Problema.Descricao</textarea>
            }
    </dd>
        @if (isOwner)
        {
        <div class="d-flex justify-content-end mt-2 mb-4">
            <button type="submit" class="btn btn-custom me-2">Salvar Alterações</button>
            <a asp-page="/PgProblema/Delete" asp-route-id="@Model.Problema.Id" class="btn btn-custom">Deletar Problema</a>
        </div>
        }
    </form>
</div>

<h3 class="d-flex justify-content-between align-items-center mb-3">
    Soluções
    <a asp-page="/PgSolucao/Create" asp-route-problemaId="@Model.Problema.Id" class="btn btn-custom">Criar Solução</a>
</h3>

@if (Model.Problema.Solucaos != null && Model.Problema.Solucaos.Any())
{
    <div class="solution-list">
        @foreach (var solucao in Model.Problema.Solucaos)
        {
            <div class="solution-item mb-3">
                <h5>Usuário: @solucao.Usuario.Nome</h5>
                <p>@solucao.Descricao</p>
                <a asp-page="/PgSolucao/Details" asp-route-id="@solucao.Id" class="btn btn-sm btn-custom">Ver Detalhes</a>
            </div>
        }
    </div>
}
else
{
    <p>Nenhuma solução cadastrada.</p>
}

@section Scripts {
    <script>
        document.querySelectorAll('.clickable-label').forEach(label => {
            label.addEventListener('click', function () {
                window.location.href = this.dataset.url;
            });
        });
    </script>
}

<style>
    .btn.btn-custom {
        background-color: #22ffb6;
        color: #000;
        border: none;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px 20px;
    }

        .btn.btn-custom:hover {
            background-color: #1ccc9a;
            color: #fff;
        }

    .text-custom {
        color: #22ffb6;
    }

    .solution-list {
        margin-top: 20px;
    }

    .solution-item {
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 5px;
        background-color: #f9f9f9;
    }

        .solution-item h5 {
            margin-bottom: 10px;
        }

        .solution-item p {
            margin-bottom: 15px;
        }
</style>
